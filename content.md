* КИ – качество изображения
* ИЛ – изображение лица
* КИЛ – качество изображения лица
* Стимул – одиночное изображение

# Mетоды оценки качества получаемых изображений
* объективные –  оценки по четко сформулированным математическим критериям, не зависящие от мнения людей.
* субъективные – основанные на привлечении людей и анализе их мнений.

Если для входных данных известно идеальное изображение, то критерии качества обычно строятся на основе метрики различий двух ответов алгоритма на идеальное и реальное изображения.

Когда идеальное изображение неизвестно, используются неэталонные оценки, которые основываются только на текущем изображении. Как правило, такие метрики используют сложный математический и статистический аппарат и являются узкоспециализированными, применяемыми только для определенного вида искажений.[1]

***

# Субъективные методы оценки
Это оценки по индивидуальным и часто неосознаваемым ("скрытым") критериям, в связи с чем они могут сильно варьироваться. Необходимо оптимизировать организацию проводимых исследований, устраняя факторы, приводящие к большой вариабельности и возможной неадекватности оценок. Общая оценка должна быть основана на мнениях большого числа разных индивидуумов для получения результата, который по своей точности и повторяемости не уступает объективному методу.

На данном этапе использование экспертного подхода остается самым адекватным и востребованным методом оценки качества изображений, несмотря на то, что применение этого метода требует четкой организации процесса тестирования и большого числа экспертов, больших затрат времени и материальных ресурсов.

Чтобы получить корректные субъективные оценки изображений, необходимо соблюдать основные правила планирования экспериментов, а для сопоставления оценок, полученных разными исследователями в разных экспериментах, необходимо еще и соблюдать одинаковый протокол эксперимента.[1]

Создание подсказки для маркировки КИЛ человеком — сложная задача из-за неоднозначности в определении КИЛ.
> при оценке одного ИЛ по шкале от 1 до 5, возникают трудности, так как понятия о значении различных уровней качества отсутствуют.

Перед оценкой качества человек должен знать, какое «качество» следует ожидать на оцениваемых ИЛ, поэтому может потребоваться предварительная подверженность изменчивости ИЛ.[2]

Существуют два вида экспертных оценок:
* абсолютные/кардинальные
    * решение только на основании собственного опыта оценщика
    * оценка качества изображения по какой-то заранее определенной шкале
    * иногда наблюдателю предлагается набор эталонных изображений
* сравнительные/ординальные
    * наблюдатель должен ранжировать набор конкретных изображений, т.е. расставить их в ряд по возрастанию/убыванию качества.[1]

***Ординальные*** (основанные на сравнении) задачи, как правило, легче для участников и занимают меньше времени, чем ***кардинальные*** (основанные на оценке) задачи.
Ординальные задачи дополнительно избегают калибровки, необходимой для кардинальных ответов от оценщиков, которые используют разные диапазоны для принятия решений.[2]

### Методы, основанные на предъявлении пар стимулов
Многие методы предполагают предъявление сдвоенных изображений, которые либо оцениваются одновременно, либо сравниваются. При этом в части методов в качестве второго изображения используется эталон, в части – другое изображение, а в некоторых может попеременно использоваться эталон или тестовое изображение.


## Кардинальные оценки
Опросник может быть составлен в виде мозаики картинок, включающей исходное изображение и изображения, обработанные разными алгоритмами. К каждой мозаике прилагается таблица множественного выбора, в которой эксперт проставляет оценки от 1 до 5 для всех изображений.

Оценки, данные каждым экспертом по каждому изображению, выбранному из большого датасета, представляют собой совокупность данных, которая затем интерпретируется.
Один из возможных способов извлечения информации из экспертной оценки – подсчитать средний результат голосования экспертов по каждому алгоритму с определением достоверности различий

### Абсолютный категориальный рейтинг ACR
Метод ACR предполагает единовременную оценку одного стимула: тестовые изображения демонстрируются поодиночке и независимо оцениваются по шкале категорий. 

Рекомендуемая шкала для оценки – от 1 до 5, со следующими условными обозначениями категорий:
* 1 – "плохо"
* 2 – "неудовлетворительно"
* 3 – "удовлетворительно"
* 4 – "хорошо"
* 5 – "отлично".

Используются и иные шкалы (от 1 до 9, от 0 до 10, ...). Время выбора ответа предлагается ограничивать десятью секундами. Для анализа результатов рекомендуется использовать среднее значение оценки с указанием стандартного отклонения.

### Абсолютный категориальный рейтинг со скрытым эталоном ACR-HR
Тестовые статические или видеоизображения демонстрируются поодиночке и независимо оцениваются по шкале категорий.

Отличие метода ACR-HR от обычного ACR в том, что помимо обработанных изображений, качество которых требуется оценить, в последовательность стимулов включены необработанные образцовые (референтные) стимулы – эталоны. Оценщики не знают, какие из стимулов эталонные и оценивают их наравне с остальными стимулами. 

Рекомендуемое время для ответа – 10 с. 

Итоговая метрика основана на разности оценок эталонов и обработанных изображений. Оценки испытуемых могут существенно различаться для разных сцен и могут зависеть от других параметров стимула, а не только от их качества. Метрика, основанная на включении эталонов, позволяет отнормировать оценки относительно субъективного восприятия качества.

Так как разные испытуемые склонны по-разному воспринимать привязку к используемым уровням шкалы, для унификации ответов используется z-преобразование для приведения оценок каждого пользователя к общему среднему и общему стандартному отклонению.

Корректная оценка качества обработки может быть проведена только для тех изображений, которым в эталонном виде эксперты дают оценку “хорошо” или “отлично” (иначе шкала оценок обрезается сверху).

### Непрерывная оценка качества одиночных стимулов SSCQE
SSCQE предназначен только для оценки видео. Метод можно реализовать, имея ручное записывающее устройство с ползунковым механизмом; рекомендованный диапазон перемещения
ползунка – около 10 см.

Испытуемые просматривают оцениваемый материал только 1 раз; эталонное видео им не предъявляют. В течение просмотра испытуемый указывает оценку качества видео в каждый момент, двигая ползунок. Шкала ползунка соответствует шкале непрерывной оценки качества (с пятью условными вспомогательными категориями: “отлично”, “хорошо”, “удовлетворительно”, “плохо”, “неприемлемо”).

Метод рассчитан именно на использование длительных тестовых отрезков и максимально приближен к реальным условиям просмотра видео. Все сочетания видеофрагментов/условий обработки должны быть предъявлены одинаковому числу участников.

Развитием метода SSCQE с введением постоянно присутствующего на соседнем экране (или половине одного экрана) эталонного стимула является метод SDSCE1 (метод непрерывной оценки качества на основе одновременных сдвоенных стимулов).
Об оценке данных, получаемых в результате

При пользовании методами моментальной оценки (SSCQE, SDSCE) испытуемые склонны несимметрично оценивать ухудшения и улучшения видео: снижение качества оценивается большинством пользователей быстро, а улучшение – с задержкой.

### Категориальная оценка ухудшения DCR
Стимулы предъявляются парами: эталон и тестовый стимул, при этом возможно
* последовательное предъявление
    сначала предъявляется эталон, и между последовательно предъявляемыми стимулами в течение двух секунд предъявляется серый экран.
* одновременное предъявление. 

После предъявления обоих стимулов испытуемые должны оценить степень ухудшения качества тестового изображения относительно эталона по 5-балльной шкале
* 5 – “незаметное”
* 4 – “заметное, но не раздражающее”
* 3 – “немного раздражающее”
* 2 – “раздражающее”
* 1 – “сильно раздражающее”

### Метод оценки на основе парных стимулов с использованием непрерывной шкалы DSCQS5
Испытуемому предъявляются два стимула: тестовый и эталонный. Испытуемый не знает, какой из стимулов – эталон, и должен оценить оба изображения по непрерывной шкале, ставя соответствующие метки. Для упрощения использования непрерывной шкалы на ней расставляются “якоря” категорий (“отлично”, “хорошо”) и другие.

Два основных варианта реализации метода:
* последовательный
    * стимулы показываются по очереди 2 раза.
    * между стимулами в течение двух секунд демонстрируется серый экран.
    * во время второго предъявления испытуемый может уже ставить оценки обоим стимулам.
    * испытуемому дается дополнительное время для голосования (около 10 секунд).
    * рекомендуемая длительность предъявления каждого стимула6 – тоже 10 с.
* одновременный
    * оба стимула демонстрируются рядом (на двух половинах дисплея или на соседних экранах) в течение 10 секунд
    * испытуемому дается 10 с для голосования. 
    * полученные оценки для тестового и эталонного стимулов переводятся в шкалу от 0 до 100, вычисляется разность между двумя оценками. 
    
Оценки часто ошибочно связывают с использованными при тестировании категориями (“отлично”, “хорошо”, “удовлетворительно”), но такое сопоставление баллов с категорией некорректно.


## Ординальные оценки
Цель задачи — собрать *относительные* попарные сравнения качества изображения лица, задав следующий вопрос:
> *«Какое лицо (левое или правое) имеет лучшее качество?»*

### Попарное сравнение PC
Стимулы предъявляются парами:
* одновременно
* последовательно
    между двумя стимулами в течение двух секунд предъявляется серый экран
    
Стимулы – обработанный двумя разными способами эталонный стимул. Испытуемый обязательно должен выбрать одно изображение как лучшее, даже если не видит разницы между ними.

Следует предъявлять n(n-1) возможных комбинаций, т.е. все пары предъявляются по 2 раза в разном порядке.

Существуют варианты сокращения процедуры, обычно принимается условие:
> если стимул А оценен ниже, чем стимул Б, а стимул В – выше, чем стимул Б, то стимул В считается оцененным выше, чем стимул А.

### Попарная оценка сходства PSJ
Стимулы предъявляются парами, и испытуемый должен выбрать лучший из стимулов (даже если не видит разницы), а затем указать по шкале от 1 до 5 степень различия между изображениями. Другой вариант – шкала от –3 до 3 (0 – “нет разницы”, 1 – “немного лучше”, 2 – “лучше”, 3 – “значительно лучше” для каждого изображения). 

Число пар для исследования выбирается так же, как и при обычном PC-методе.

### Непрерывная оценка качества на основе одновременных сдвоенных стимулов SDSCE
Для реализации метода рекомендуется использовать ручное записывающее устройство с ползунковым механизмом, как и в методе SSCQE. 

SDSCE использует не одно видео, а два: тестовое и эталонное, показываемые одновременно. Испытуемый во время просмотра сравнивает эталонное и тестовое видео и двигает ползунок устройства, указывая моментальную оценку качества. 

Преимущества метода:
* возможность моментальной оценки качества
* возможность демонстрации длительных видео, что ближе к реальным условиям просмотра.

Считается, что данный метод ориентирован скорее на оценку точности передачи, а не качества самого изображения.

Недостатками метода считаются
* необходимость перевода взгляда (и внимания) с одного стимула на другой и разная скорость реакции испытуемых. 
* испытуемый может терять ощущение абсолютного положения ползунка на шкале (переводить его выше или ниже предыдущей оценки, но не соотносить выставляемую оценку с крайними положениями шкалы).[1]

### Краудсорсинговые сравнения качества лица:
Имея перед собой пару ИЛ, отображаемых рядом, человек выбирает одно из утверждений о сравнении изображений. Пример:
1. левое лицо намного лучше,
2. левое лицо немного лучше,
3. оба лица похожи, 
4. правое лицо немного лучше, 
5. правое лицо намного лучше.

База данных ИЛ состоит из обучающих пар, случайных пар и пар проверки согласованности:
* Учебные пары предварительно выбираются так, чтобы качество одного изображения было явно лучше, чем качество другого.
* Пары проверки на согласованность выбираются из набора случайных пар как дубликаты.
    Принимаются ответы от оценщиков, которые успешно прошли, по крайней мере, `m` из `n` пар проверок согласованности. 

### Получение абсолютных оценок качества для отдельных ИЛ
#### [Подход завершения матрицы](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.651.1226&rep=rep1&type=pdf)
Так как несколько человек не могут вручную оценить качество всех ИЛ в *большой* базе данных, преимущество данного метода — он требует лишь *небольшого* набора парных меток качества от каждого человека-оценщика, чтобы вывести оценки качества для *всей* БД.

Цель — вывести матрицу качества ИЛ размером `количество рабочих` на `количество ИЛ`.

Подход основан на предположении *низкого ранга* результирующей матрицы: человеческие оценки качества вряд ли будут полностью независимы друг от друга, так как они основываются на одинаковых факторах (поза лица, освещенность, резкость, окклюзия и т.д.).
Только `O(r log m)` запросов необходимы для выведения полного ранжированного списка оценщика всех `m` ИЛ, где `r` - ранг неизвестной матрицы рейтинга `(r << m)`.
Максимально возможный ранг неизвестной рейтинговой матрицы равен числу оценщиков `(max r = n)`.

Результирующая матрица содержит предполагаемые оценки качества лица для всех `m` ИЛ для каждого из `n` оценщиков.

Существует обратная зависимость между количеством пар, которые оценщик пометил «схожими», и результирующим диапазоном предполагаемых оценок качества этого оценщика:

```диапазон = (максимальная оценка качества) - (минимальная оценка качества)```

Из-за этого наблюдения проводится нормализация min-max для преобразования оценок качества всех оценщиков в один и тот же диапазон `[0, 1]`.

Чтобы получить единую оценку качества для каждого изображения лица в базе данных, используется средняя оценка качества у всех `n` оценщиков, чтобы уменьшить матрицу `n × m` до вектора оценок качества `1 × m` ( по одной на ИЛ).[2]


## Общие рекомендации по проведению эксперимента
#### Инструктаж 
* инструкции в письменном виде, чтобы все испытуемые получили одинаковую инструкцию (дополнительно ее нужно дублировать устно).
* на все вопросы испытуемых нужно дать исчерпывающие ответы. 

#### Обучающие стимулы
* включать обучающие последовательности в начало эксперимента
* оценки, полученные на обучающих последовательностях, не учитываются в итоговых результатах
* стабилизирующие последовательности, которые не учитываются в результатах оценки (для испытуемого они обозначаются как тестовые, а не как тренировочные)

#### Повторения (кроме PC)
* как минимум два, а лучше три или четыре повторения идентичных стимула/набора стимулов
* причина – индивидуальная вариабельность оценок у каждого испытуемого, которую можно оценить и учесть благодаря повторным измерениям
* компенсируют эффекты обучения и уставания

#### Планирование
* учитывать возможность влияния порядка предъявляемых стимулов
* к концу тестовой последовательности испытуемые могут уставать или врабатываться и лучше понимать задачу
* можно использовать общепринятые стратегии

#### Условия просмотра
* указывать все характеристики дисплея, тип используемой видеокарты и прочее
* фон должен соответствовать 50%-ному серому (если не во весь экран)

#### Испытуемые (наблюдатели)
* число участников предварительных серий экспериментов может быть 4–8
* в тестовом просмотре обычно участвуют 15–40 испытуемых
* проверять цветовосприятие и остроту зрения испытуемых
* указывать экспертный уровень участников
    * необученные наблюдатели
    * не имеющие опыта оценки искажений изображения
    * опытные наблюдатели-эксперты
* испытуемые не должны быть непосредственными участниками разработки испытываемой системы/способа обработки изображений
* приводить данные о возрастном и половом составе, образовании и профессиональной категории испытуемых

#### Проверка надежности испытуемых
* для каждого испытуемого подсчитывается число оценок, которые лежат за пределами двух стандартных отклонений от среднего по группе
* исключаются те испытуемые, у которых доля таких оценок превышает 5% или вероятность получения оценок, отличающихся от среднего более, чем на два стандартных отклонения, не стремится к нулю с увеличением отличия от среднего
* при предъявлении эталонного видео/изображения вместо стимульного испытуемые должны давать оценки, соответствующие полному или почти полному отсутствию различий между стимулами 
* применяется линейное преобразование, приводящее индивидуальные средние значения и дисперсии к общему среднему значению и дисперсии для всех пользователей (z-преобразование). 

#### Выбор шкалы оценки
* использовать ликертовскую 5-балльную шкалу (“отлично”, “хорошо”, “удовлетворительно, “неудовлетворительно”, “плохо”)
* испытуемые могут давать ответы как в вербальной форме, так и в числовых значениях
* окончательный выбор шкалы и разработка инструкции по ее использованию остаются на усмотрение экспериментаторов и должны соответствовать проводимому измерению
* переводы словесных наименований одних и тех же категорий шкалы могут немного отличаться по смыслу и иметь разные оттенки, что иногда вносит искажения в результаты, несмотря на стандартизацию процедуры
* учитывать локальные привычки и практику употребления определенных балльных систем

#### Дополнительные шкалы
* рекомендуют использовать шесть положительных и пять отрицательных шкал
* положительные шкалы вводят для оценки яркости, контрастности, цветовоспроизведения, очертаний контура, стабильности фона, скорости сборки предъявляемого изображения
* по отрицательным шкалам оценивают подергивание, эффекты размытия, эффект москитного шума, двойные изображения/тени, гало
* рекомендуют использовать квазинепрерывную шкалу
* полученные данные можно объединить с определенными весовыми коэффициентами в общую оценку качества

#### Длительности предъявления стимулов
* для видеостимулов рекомендуется ограничивать время предъявления 10 секундами
* для статических изображений достаточно и 3 секунд предъявления 
* если стимулы показываются один за другим, между ними в течение полутора-двух секунд предъявляется пустой серый экран
* время для голосования рекомендуется ограничить десятью секундами
* экспериментальные серии не следует делать слишком длительными, а в сами сессии иногда следует вводить короткие перерывы
* продолжительность сеанса не должна превышать получаса (включая объяснения и предварительные этапы)
* учитывать различные психологические эффекты, связанные с временными характеристиками восприятия

***

# Объективные методы оценки

Когда потребителем контента является человек, используемые при автоматизированной обработке критерии нужно приближать к "человеческим".

Предполагает использование метрик оценки качества изображения – формальных математических критериев, основанных на физических параметрах изображения.

Основным недостатком математических объективных метрик является их слабая корреляция с субъективными оценками. Поэтому стали разрабатываться и метрики, обоснованные на уровне неких общих представлений о зрительной системе человека (для задач обработки изображений, предназначенных для визуализации, где логично не учитывать различия, игнорируемые ЗСЧ).[1]

***

# Способы оценки алгоритмов
### Выбор лучшего кадра
## Оценка *кадров* видео
Чтобы получить данные о человеческом предпочтении наиболее репрезентативных кадров в коротких видеороликах, выбранная последовательность кадров каждого видео была представлена в Amazon Mechanical Turk (AMT) для сбора аннотаций для каждого кадра. Только работники, прошедшие квалификационный тест, могли оценивать 19 кадров из каждого видео по шкале [1, 2, 3], где 3 означает, что кадр может использоваться для представления видео и имеет высокое качество визуального изображения, а 1 обозначает кадр с низким качеством визуального изображения, не описывающий содержимое видео.

**Для контроля качества аннотаций** *случайным образом* были вставлены короткие видеоролики *с известной ground truth*. У этих видео присутствует явно лучший кадр, поэтому внимательные работники должны выбрать лучший кадр. Каждое видео помечается пятью разными сотрудниками AMT, и в качестве ground truth исользуется *взвешенная усредненная оценка* по пяти сотрудникам AMT, в которой веса пропорциональны точности сотрудников в контроле качества и нормализуются между пятью сотрудниками.

Т.е. для оценки лучшего кадра используется ***Абсолютный категориальный рейтинг со скрытым эталоном***.

## Оценка *подходов* выбора лучшего кадра
Для оценки различных подходов выбора лучшего кадра коротких видеороликов были введены новые метрики оценки.

Хотя для оценки моделей ранжирования широко используется *ранговая корреляция Спирмена*, в задаче оценки выбора лучшего кадра более важно определить, является ли предсказанный кадр лучшим или нет, а не оценить точность предсказанных значений качества кадров в видео.

Вместо этого можно рассчитать **различия** между выбранным кадром и лучшим по ground truth кадром и использовать эту информацию для оценки.

### Score difference (SD)
Это среднее значение разниц между *значениями ground truth* выбранного моделью кадра и лучшего кадра для каждого видео.

### Rank Difference (RD)
Все кадры видео сортируются от худшего к лучшему по значениям ground truth, получая свой *ранг*. RD определяется как среднее значение разниц между *рангами* выбранного моделью кадра и лучшего кадра для каждого видео.

### Accurate Percentage (AP)
Это отношение количества видео, в которых выбранный моделью кадр совпадает с лучшим, к общему числу видео.

Лучший подход выбора кадра имеет меньшее значение SD и RD и большее значение AP.


1. Грачева А., Божкова В. П., Казакова А. А., Рожкова Г. И. Субъективная оценка качества статических и видеоизображений: методологический обзор // Сенсорные системы, том 33. 2019. №4. [[Текст]](https://vis.iitp.ru/pdf/papr/12/2019_GrachevaMA_BozhkovaVP_KazakovaAA_et_al_Subektivnaya_otsenka_kachestva_staticheskikh_i_video_izobrazheniy_metodologicheskiy_obzor_1232_.pdf)
2. Lacey Best-Rowden, Anil K. Jain Learning Face Image Quality from Human Assessments // Transactions on information forensics and security. IEEE, 2018. [[Текст]](https://pdfs.semanticscholar.org/ddf0/99f0e0631da4a6396a17829160301796151c.pdf)
3. Jian Ren, Xiaohui Shen, Zhe Lin, Radomír Měch Best Frame Selection in a Short Video // Winter Conference on Applications of Computer Vision (WACV). IEEE, 2020. [[Текст]](https://openaccess.thecvf.com/content_WACV_2020/papers/Ren_Best_Frame_Selection_in_a_Short_Video_WACV_2020_paper.pdf)
4. Huiwen Chang, Fisher Yu, Jue Wang, Douglas Ashley, Adam Finkelstein Automatic Triage for a Photo Series // ACM Transactions on Graphics. Association for Computing Machinery, 
2016. [[Текст]](https://www.juew.org/publication/sig16-triage.pdf)
